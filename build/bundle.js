webpackJsonp([0],{10:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var o=n(3),r=i(o),a=n(28),u=i(a),c=n(9),s=i(c),d={helpText:"",projects:[],mapWidth:0,mapHeight:0,form:{isOpen:!1,title:"",description:""},authenticationUrl:"",username:"",selectedProject:{}},l=new u.default({organization:"bkkhack",repository:"hackmap",label:"BKKHack Main Thread",onAuthenticationRequired:s.default.getOAuthToken,pollIntervalSeconds:60,onProjectsUpdated:function(e){d.projects=e},onHelpText:function(e){d.helpText=e},onUserAuthenticated:function(e){d.username=e.data.login}});new r.default({el:".projects.side-column",data:d,methods:{toggleForm:function(){var e=this;return this.form.isOpen?(this.form.title=this.form.title.trim(),this.form.description=this.form.description.trim(),this.form.title||this.form.description?this.form.title?(l.postNewProject(this.form).then(function(t){e.projects.push(t),e.form.title="",e.form.description=""}).catch(function(e){return console.error(e)}),void(this.form.isOpen=!1)):void alert("Please enter a topic for your project"):void(this.form.isOpen=!1)):void(this.form.isOpen=!0)},drag:function(e){console.log(e);var t=e.target.querySelector("img");e.dataTransfer.setDragImage(t,20,20);var n=e.target.dataset.id;e.dataTransfer.setData("projectId",n)}}}),new r.default({el:".center-column",data:d,methods:{dragover:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},drag:function(e){var t=e.target.dataset.id;e.dataTransfer.setData("projectId",t)},drop:function(e){var t=e.dataTransfer.getData("projectId"),n=d.projects.filter(function(e){return e.id==t})[0];this.updateMapDimensions();var i=n.x,o=n.y;n.x=e.offsetX/d.mapWidth,n.y=e.offsetY/d.mapHeight,l.updateProject(n).catch(function(e){console.log("update rejected"),n.x=i,n.y=o})},updateMapDimensions:function(){var e=this.$el.querySelector(".floorplan");d.mapWidth=e.clientWidth,d.mapHeight=e.clientHeight},login:function(){l.ensureAuthenticatedClient()},logout:function(){d.username="",l.deauthenticateClient()}},mounted:function(){window.addEventListener("resize",this.updateMapDimensions),this.updateMapDimensions()},beforeDestroy:function(){window.removeEventListener("resize",this.updateMapDimensions)}}),new r.default({el:".details.side-column",data:d,methods:{toggleEditMode:function(){var e=d.selectedProject;e.editMode?(e.title=e.backup.title,e.description=e.backup.description):e.backup={title:e.title,description:e.description},e.editMode=!e.editMode},updateProject:function(){l.updateProject(d.selectedProject).then(function(){d.selectedProject.editMode=!1}).catch(function(e){console.log("update rejected");var t=d.selectedProject.backup;d.selectedProject.title=t.title,d.selectedProject.description=t.description})}}})},28:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(1),u=i(a),c=n(29),s=i(c),d=n(9),l=i(d),f=function(){function e(t){var n=this;o(this,e),this.config=t,this.github=this.createGithubApiClient(t.organization,t.repository),l.default.isLoggedIn()&&this.ensureAuthenticatedClient(),this.github.repo.get("issues",{params:{labels:this.config.label}}).then(function(e){if(!e.data.length)throw"Could not find an open issue labeled: "+n.config.label;var i=e.data[0];t.onHelpText(i.body),n.issueNumber=i.number}).then(function(){return n.pollIssueForComments()}).catch(function(e){return n.reportError(e)})}return r(e,[{key:"postNewProject",value:function(e){var t=this;return this.ensureAuthenticatedClient().then(function(){var n=s.default.serializeProjectToComment(e);return t.github.repo.post("issues/"+t.issueNumber+"/comments",{body:n})}).then(function(e){return s.default.deserializeCommentToProject(e.data)})}},{key:"updateProject",value:function(e){var t=this;return this.ensureAuthenticatedClient().then(function(){var n=s.default.serializeProjectToComment(e);return t.github.repo.patch("issues/comments/"+e.id,{body:n})}).then(function(e){return s.default.deserializeCommentToProject(e.data)})}},{key:"pollIssueForComments",value:function(){var e=this,t="issues/"+this.issueNumber+"/comments",n=function(){return console.log("polling..."),e.github.repo.get(t).then(function(t){var n=t.data.map(s.default.deserializeCommentToProject);e.config.onProjectsUpdated(n)}).catch(function(t){return e.reportError(t)})};return window.setInterval(n,1e3*this.config.pollIntervalSeconds),n()}},{key:"ensureAuthenticatedClient",value:function(){var e=this;return this.config.onAuthenticationRequired().then(function(t){if(!e.github.isAuthenticated)return e.github=e.createGithubApiClient(e.config.organization,e.config.repository,t),e.github.isAuthenticated=!0,e.github.get("user")}).then(function(t){t&&e.config.onUserAuthenticated(t)})}},{key:"deauthenticateClient",value:function(){l.default.logOut(),this.github=this.createGithubApiClient(this.config.organization,this.config.repository)}},{key:"createGithubApiClient",value:function(e,t,n){function i(e){var t={baseURL:"https://api.github.com/"+(e||"")};return n&&(t.headers={Authorization:"token "+n}),t}var o=u.default.create(i());return o.repo=u.default.create(i("repos/"+e+"/"+t+"/")),o}},{key:"reportError",value:function(e){console.log(e)}}]),e}();t.default=f},29:function(e,t,n){"use strict";function i(e){var t=e.slice(-1)[0],n=o.exec(t);return n?{x:n[1],y:n[2]}:{x:0,y:0}}Object.defineProperty(t,"__esModule",{value:!0});var o=/<!-- ([.\d]+),([.\d]+) -->/;t.default={deserializeCommentToProject:function(e){var t=e.body.split("\r\n"),n=i(t);return{id:e.id,title:t[0],description:t[1],username:e.user.login,avatar_thumbnail:e.user.avatar_url+"&s=40",avatar:e.user.avatar_url+"&s=120",x:n.x,y:n.y,editMode:!1}},serializeProjectToComment:function(e){return e.title+"\r\n"+(e.description||"")+"\r\n\x3c!-- "+e.x+","+e.y+" --\x3e"}}},33:function(e,t,n){e.exports=n(10)},9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=function(e){return e&&e.__esModule?e:{default:e}}(i),r=window.location.href.indexOf("index.html")>=0?window.location.href.replace("index.html","oauth_redirect.html"):window.location.href+"oauth_redirect.html",a="https://github.com/login/oauth/authorize?scope=public_repo&redirect_uri="+r+"&client_id=1b717d04ec7f3615bb18",u="https://bkkhackmap.herokuapp.com/authenticate/";o.default.options(u),t.default={isLoggedIn:function(){return!!window.localStorage.getItem("token")},logOut:function(){window.localStorage.removeItem("token")},getOAuthToken:function(){return new Promise(function(e,t){var n=window.localStorage.getItem("token");if(n)return void e(n);var i=window.open(a);window.addEventListener("oauth-code-received",function(n){var r=n.detail;o.default.get(u+r).then(function(t){window.localStorage.setItem("token",t.data.token),i.close(),e(t.data.token)}).catch(function(e){return t(e)})})})}}}},[33]);
//# sourceMappingURL=bundle.js.map